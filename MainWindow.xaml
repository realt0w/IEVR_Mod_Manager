<Window x:Class="IEVRModManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="IEVR Mod Manager 1.4.1" 
        Height="800" Width="1200"
        MinHeight="600" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BgBrush}">
    <Window.Resources>
        <Style x:Key="SuccessAccentButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource AccentButtonStyle}">
            <Setter Property="Background" Value="#00b26b"/>
            <Setter Property="BorderBrush" Value="#00b26b"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#00995c"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#555555"/>
                    <Setter Property="BorderBrush" Value="#555555"/>
                    <Setter Property="Foreground" Value="#b3b3b3"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" MinHeight="450"/>
            <RowDefinition Height="200" MaxHeight="200"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <Label Grid.Row="0" Content="IE:VR Mod Manager 1.4.1" 
               FontSize="24" FontWeight="Bold" 
               Foreground="{StaticResource TextBrush}"
               HorizontalAlignment="Center" 
               Margin="12,12,12,8"/>

        <!-- Center Frame: Mods List and Controls -->
        <Grid Grid.Row="1" Margin="12,0,12,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" MinWidth="400"/>
                <ColumnDefinition Width="*" MinWidth="180"/>
            </Grid.ColumnDefinitions>

            <!-- Mods Panel (Left) -->
            <Grid Grid.Column="0" Margin="0,0,8,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <GroupBox Grid.Row="0" Header="Mods (Priority Order)" Padding="8">
                    <ListView x:Name="ModsListView" 
                              SelectionMode="Single"
                              MouseDoubleClick="ModsListView_MouseDoubleClick"
                              SelectionChanged="ModsListView_SelectionChanged">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="âœ“" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding EnabledIcon}" 
                                                       FontSize="14"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="{StaticResource ErrorBrush}"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Enabled}" Value="True">
                                                                <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Mod Name" Width="280" DisplayMemberBinding="{Binding DisplayName}"/>
                                <GridViewColumn Header="Version" Width="80" DisplayMemberBinding="{Binding ModVersion}"/>
                                <GridViewColumn Header="Game Ver." Width="90" DisplayMemberBinding="{Binding GameVersion}"/>
                                <GridViewColumn Header="Author" Width="160" DisplayMemberBinding="{Binding Author}"/>
                                <GridViewColumn Header="Link" Width="240">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ModLink}"
                                                       TextTrimming="CharacterEllipsis"
                                                       Cursor="Hand"
                                                       MouseLeftButtonUp="ModLink_Click">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=IsSelected}" Value="True">
                                                                <Setter Property="Foreground" Value="{StaticResource TextBrightBrush}"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </GroupBox>

                <!-- Quick Actions -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Stretch" Margin="0,8,0,8">
                    <Button Content="ðŸ” Scan Mods" Style="{StaticResource PrimaryButtonStyle}" 
                            Padding="16,10"
                            MinWidth="140"
                            Click="ScanMods_Click" Margin="0,0,4,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                    <Button Content="ðŸ“‚ Open Mods Folder" Style="{StaticResource PrimaryButtonStyle}" 
                            Padding="16,10"
                            MinWidth="160"
                            Click="OpenModsFolder_Click" Margin="4,0,8,0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,8,0">
                        <Label Content="Version:" Foreground="{StaticResource TextBrush}" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <ComboBox x:Name="CpkSelector"
                                  Width="240"
                                  ItemsSource="{Binding}"
                                  DisplayMemberPath="DisplayName"
                                  SelectedValuePath="FileName"
                                  SelectionChanged="CpkSelector_SelectionChanged"
                                  Margin="0,0,6,0"/>
                        <Button Content="â¬‡ï¸ Download cpk_list"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Click="DownloadCpkLists_Click"
                                Width="170"
                                Margin="0,0,6,0"/>
                    </StackPanel>
                    <TextBlock Text="ðŸ“– Help" 
                               Foreground="{StaticResource AccentBrush}"
                               FontSize="12"
                               Cursor="Hand"
                               VerticalAlignment="Center"
                               Margin="4,0,0,0"
                               MouseEnter="HelpLink_MouseEnter"
                               MouseLeave="HelpLink_MouseLeave"
                               MouseLeftButtonDown="HelpLink_Click"/>
                </StackPanel>

                <!-- Apply/Play Buttons -->
                <Grid Grid.Row="2" HorizontalAlignment="Stretch">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Button x:Name="ApplyButton"
                            Grid.Column="0"
                            Content="âœ“ Apply Changes" 
                            Style="{StaticResource AccentButtonStyle}"
                            Click="ApplyMods_Click" 
                            HorizontalAlignment="Stretch"
                            Margin="0,0,6,0"/>
                    <Button x:Name="PlayButton"
                            Grid.Column="1"
                            Content="â–¶ Play"
                            Style="{StaticResource SuccessAccentButtonStyle}"
                            Click="PlayButton_Click"
                            HorizontalAlignment="Stretch"
                            Margin="6,0,0,0"/>
                </Grid>
            </Grid>

            <!-- Controls Panel (Right) -->
            <GroupBox Grid.Column="1" Header="Mod Actions" Padding="10">
                <StackPanel>
                    <Button Content="â¬†ï¸ Move Up" Style="{StaticResource PrimaryButtonStyle}" 
                            Click="MoveUp_Click" Margin="0,0,0,4" HorizontalAlignment="Stretch"/>
                    <Button Content="â¬‡ï¸ Move Down" Style="{StaticResource PrimaryButtonStyle}" 
                            Click="MoveDown_Click" Margin="0,0,0,8" HorizontalAlignment="Stretch"/>
                    
                    <Separator Margin="0,0,0,8"/>
                    
                    <Button Content="âœ… Enable All" Style="{StaticResource PrimaryButtonStyle}" 
                            Click="EnableAll_Click" Margin="0,0,0,4" HorizontalAlignment="Stretch"/>
                    <Button Content="âŒ Disable All" Style="{StaticResource PrimaryButtonStyle}" 
                            Click="DisableAll_Click" HorizontalAlignment="Stretch"/>

                    <Separator Margin="0,8,0,8"/>

                    <Button Content="ðŸ’¾ Create Backup" Style="{StaticResource PrimaryButtonStyle}"
                            Click="CreateBackup_Click" Margin="0,0,0,4" HorizontalAlignment="Stretch"/>
                    <Button Content="â¤´ Restore Backup" Style="{StaticResource PrimaryButtonStyle}"
                            Click="RestoreBackup_Click" HorizontalAlignment="Stretch"/>
                </StackPanel>
            </GroupBox>
        </Grid>

        <!-- Log Panel -->
        <GroupBox Grid.Row="2" Header="Activity Log" Margin="12,8,12,12" Padding="8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <TextBox x:Name="LogTextBox" 
                         Grid.Row="0"
                         IsReadOnly="True" 
                         TextWrapping="Wrap"
                         FontFamily="{StaticResource FontMono}"
                         FontSize="11"
                         Background="{StaticResource BgBrush}"
                         Foreground="{StaticResource TextBrush}"
                         BorderThickness="0"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Disabled"/>

            </Grid>
        </GroupBox>

        <!-- Bottom Frame: Downloads, Configuration, Exit -->
        <Grid Grid.Row="3" Margin="12,0,12,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="ðŸ“¥ Downloads" 
                    Style="{StaticResource PrimaryButtonStyle}" 
                    Click="Downloads_Click" 
                    Width="180" Margin="0,0,6,0"/>
            <Button Grid.Column="1" Content="âš™ï¸ Configuration" 
                    Style="{StaticResource PrimaryButtonStyle}" 
                    Click="Configuration_Click" 
                    Width="180" Margin="6,0,0,0"/>
            <Button Grid.Column="3" Content="Copy Log" 
                    Style="{StaticResource PrimaryButtonStyle}" 
                    Padding="16,10"
                    MinWidth="110"
                    Click="CopyLog_Click" 
                    Margin="6,0,6,0"/>
            <Button Grid.Column="4" Content="Save Log" 
                    Style="{StaticResource PrimaryButtonStyle}" 
                    Padding="16,10"
                    MinWidth="110"
                    Click="SaveLog_Click" 
                    Margin="0,0,6,0"/>
            <Button Grid.Column="5" Content="âœ• Exit" 
                    Style="{StaticResource PrimaryButtonStyle}" 
                    Click="Exit_Click" 
                    Width="140"/>
        </Grid>
    </Grid>
</Window>

